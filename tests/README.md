# Тестирование DUB NVIDIA HEVC Encoder

## Требования

Для запуска тестов необходимо:
1. Python 3.11 или выше
2. Установленные зависимости из requirements-dev.txt
3. FFmpeg и FFprobe в корневой директории проекта

## Установка зависимостей

```bash
pip install -r requirements-dev.txt
```

## Структура тестов

- `tests/encoding/` - тесты компонента кодирования
- `tests/ffmpeg/` - тесты FFmpeg утилит
- `tests/integration/` - интеграционные тесты GUI и бэкенда
- `tests/ui/` - тесты UI компонентов

## Запуск тестов

### Все тесты
```bash
pytest
```

### Конкретная группа тестов
```bash
pytest tests/ui/  # только UI тесты
pytest tests/encoding/  # только тесты кодировщика
pytest tests/ffmpeg/  # только тесты FFmpeg
pytest tests/integration/  # только интеграционные тесты
```

### С подробным выводом
```bash
pytest -v
```

### С покрытием кода
```bash
pytest --cov=src
```

## Фикстуры

- `qapp` - создает экземпляр QApplication
- `temp_dir` - создает временную директорию
- `sample_video` - создает тестовый видеофайл
- `mock_ffmpeg_paths` - мокает пути к FFmpeg
- `mock_nvidia_hardware` - мокает информацию об оборудовании NVIDIA
- `close_message_box` - автоматически закрывает диалоговые окна

## Написание новых тестов

1. Используйте фикстуры из conftest.py
2. Для UI тестов используйте qtbot
3. Для тестов с файлами используйте tmp_path
4. Мокайте длительные операции FFmpeg
5. Проверяйте корректность передачи параметров между UI и бэкендом

## Известные особенности

1. Тесты UI требуют запущенного X-сервера или работающего оконного менеджера
2. Некоторые тесты могут быть пропущены, если FFmpeg не найден
3. Тесты могут быть медленнее на системах без NVIDIA GPU