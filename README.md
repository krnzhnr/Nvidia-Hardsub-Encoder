# NVIDIA HEVC Encoder GUI

Графический интерфейс (GUI) для пакетного кодирования видеофайлов в формат HEVC (H.265) с использованием аппаратного ускорения NVIDIA NVENC через FFmpeg. Приложение также поддерживает автоматическое извлечение и вшивание субтитров (если они названы определенным образом) и использование встроенных в видеофайл или пользовательских шрифтов.

![image](https://github.com/user-attachments/assets/6840641b-22ee-4be0-bc2d-50dc550c41aa)

<!-- Замените placeholder_screenshot.png на реальный скриншот вашего приложения -->

## Возможности

*   **Пакетное кодирование:** Обработка нескольких видеофайлов за один раз.
*   **Аппаратное ускорение NVIDIA NVENC:** Быстрое кодирование с использованием GPU NVIDIA.
*   **Выбор целевого битрейта:** Пользователь может указать желаемый средний битрейт для видео.
    *   Максимальный битрейт и размер буфера рассчитываются автоматически (2x от среднего и 2x от максимального соответственно).
*   **Принудительное изменение разрешения:**
    *   Возможность выбрать выходное разрешение.
    *   Список доступных разрешений генерируется адаптивно на основе исходного разрешения первого выбранного файла (с использованием множителей x2, x1.5, x1, x0.66, x0.5 и стандартных 720p/1080p, если они меньше исходного).
*   **Вшивание субтитров:**
    *   Автоматический поиск дорожки субтитров в исходном файле по ключевому слову в названии дорожки (по умолчанию: "Надписи").
    *   Извлечение найденной дорожки субтитров в формат ASS.
*   **Поддержка шрифтов для субтитров:**
    *   Автоматическое извлечение шрифтов, встроенных в видеофайл (если они есть и поддерживаются).
    *   Возможность использования пользовательских шрифтов, размещенных в папке `fonts` рядом с приложением.
    *   Приоритет отдается извлеченным шрифтам, затем шрифтам из папки `fonts`, затем системным.
*   **Выбор папки для вывода:** Пользователь может указать, куда сохранять закодированные файлы.
*   **Индикация прогресса:** Отображение прогресса для текущего файла и общего прогресса по всем файлам.
*   **Логирование:** Подробный вывод информации о процессе кодирования и возможных ошибках.
*   **Проверка компонентов:** Автоматическая проверка наличия FFmpeg, FFprobe и совместимого GPU NVIDIA с драйверами.

## Требования

*   **Windows** (разработано и тестировалось на Windows).
*   **Видеокарта NVIDIA** с поддержкой NVENC (большинство современных карт серий GeForce, Quadro, Tesla).
*   **Актуальные драйверы NVIDIA.**
*   **FFmpeg и FFprobe:** Исполняемые файлы `ffmpeg.exe` и `ffprobe.exe` должны находиться в той же папке, что и основной скрипт (`main.py`) или собранное приложение (`.exe`). Рекомендуется использовать свежую сборку FFmpeg с включенной поддержкой NVENC и libass (для субтитров).

## Установка и запуск

### Для пользователей (если будет собранное .exe приложение):

1.  Скачайте архив с последней версией приложения из раздела [Релизы](https://github.com/krnzhnr/Nvidia-Hardsub-Encoder/releases).
2.  Распакуйте архив в удобную для вас папку.
3.  Убедитесь, что файлы `ffmpeg.exe` и `ffprobe.exe` находятся в той же папке, что и основной исполняемый файл приложения. Если их нет, скачайте их с [официального сайта FFmpeg](https://ffmpeg.org/download.html) (выберите сборку для Windows с поддержкой `nvenc`).
4.  (Опционально) Создайте папку `fonts` в директории приложения и поместите туда файлы шрифтов (.ttf, .otf), которые вы хотите использовать для субтитров, если они не встроены в видео и не установлены в системе.
5.  Запустите исполняемый файл приложения.

### Для разработчиков (запуск из исходного кода):

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/krnzhnr/Nvidia-Hardsub-Encoder.git
    cd Nvidia-Hardsub-Encoder
    ```

2.  **Создайте и активируйте виртуальное окружение (рекомендуется):**
    ```bash
    python -m venv venv
    # Для Windows:
    venv\Scripts\activate
    # Для Linux/macOS:
    source venv/bin/activate
    ```

3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Разместите FFmpeg:**
    *   Скачайте `ffmpeg.exe` и `ffprobe.exe` с [официального сайта FFmpeg](https://ffmpeg.org/download.html) (сборку для Windows с поддержкой `nvenc`).
    *   Поместите их в корневую папку проекта (туда же, где `main.py`).

5.  **(Опционально) Папка для шрифтов:**
    *   Создайте папку `fonts` в корневой директории проекта.
    *   Поместите туда файлы шрифтов (.ttf, .otf).

6.  **Запустите приложение:**
    ```bash
    python main.py
    ```

## Использование

1.  **Запустите приложение.**
2.  **Выберите видеофайлы:** Нажмите кнопку "Выбрать видеофайлы" и выберите один или несколько файлов для кодирования.
3.  **Настройте параметры (справа):**
    *   **Папка для вывода:** Укажите, куда сохранять готовые файлы. По умолчанию используется подпапка `ENCODED_HEVC_NVIDIA_GUI` в директории приложения.
    *   **Целевой средний битрейт:** Установите желаемый битрейт в Мбит/с.
    *   **Принудительное разрешение вывода:**
        *   Установите галочку, чтобы активировать эту опцию.
        *   Выберите желаемое выходное разрешение из выпадающего списка. Список генерируется на основе разрешения первого выбранного видеофайла.
4.  **Начать кодирование:** Нажмите кнопку "Начать кодирование".
5.  **Отслеживайте прогресс:** Прогресс будет отображаться для каждого файла и в общем. Подробные логи процесса выводятся в нижней части окна.
6.  **Остановка кодирования:** В любой момент можно нажать кнопку "Остановить кодирование". Текущий обрабатываемый файл не будет сохранен (или будет удален, если был частично создан).

## Конфигурация (в коде)

Некоторые параметры заданы как константы в файле `config.py`:

*   `VIDEO_EXTENSIONS`: Список расширений видеофайлов, которые будут отображаться в диалоге выбора.
*   `OUTPUT_SUBDIR`: Имя подпапки для вывода по умолчанию.
*   `DEFAULT_TARGET_V_BITRATE_MBPS`: Целевой битрейт по умолчанию.
*   Параметры NVENC (`NVENC_PRESET`, `NVENC_TUNING`, `AUDIO_CODEC` и т.д.): Могут быть изменены в коде для тонкой настройки кодирования.
*   `SUBTITLE_TRACK_TITLE_KEYWORD`: Ключевое слово для поиска дорожки субтитров.
*   `FONTS_SUBDIR`: Имя папки для пользовательских шрифтов.

## Возможные проблемы и их решения

*   **"Компонент FFmpeg/FFprobe не найден"**: Убедитесь, что `ffmpeg.exe` и `ffprobe.exe` находятся в той же папке, что и приложение.
*   **"Не удалось подтвердить наличие NVIDIA GPU/драйвера..."**: Проверьте, установлены ли корректно драйверы NVIDIA. Убедитесь, что ваша видеокарта поддерживает NVENC. Попробуйте обновить драйверы.
*   **Ошибки FFmpeg с кодом `429496...` или `Invalid argument`**: Часто связаны с некорректными путями к файлам или ошибками в синтаксисе фильтров. Если ошибка повторяется, проверьте логи на наличие сообщений от FFmpeg.
*   **Субтитры отображаются некорректными шрифтами**:
    *   Убедитесь, что необходимые шрифты встроены в видео, или скопированы в папку `fonts`, или установлены в системе.
    *   Проверьте, что ключевое слово для поиска дорожки субтитров в `config.py` соответствует названию дорожки в ваших файлах.
*   **Низкая скорость кодирования**: Зависит от мощности GPU, сложности видео и выбранных настроек NVENC (например, пресета).

## Лицензия

Этот проект распространяется под лицензией [MIT](LICENSE.md) (если вы добавите файл LICENSE.md с текстом лицензии MIT).

## Благодарности

*   Команде [FFmpeg](https://ffmpeg.org/) за мощный инструмент для работы с медиа.
*   Разработчикам [PyQt](https://riverbankcomputing.com/software/pyqt/) за отличную Python-обертку для Qt.

---
Создано с ❤️ и Python.
